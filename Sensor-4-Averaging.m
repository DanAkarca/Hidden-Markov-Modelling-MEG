%% Sensor level analysis: Grandaveraging script
%  Danyal Akarca, MPhil Candidate in Basic and Translational Neuroscience
%% Load filtered dataset
base='/imaging/da04/'
filenames={'feAdspm12meg14_0440_140509_task1_raw_mc_oddball.mat',...
           'feAdspm12meg14_0440_140509_part2_raw_mc_oddball.mat',...
           'feAdspm12meg14_0432_140218_TaskBlock2_raw_mc_oddball.mat',...
           'feAdspm12meg14_0432_140218_TaskBlock1_raw_mc_oddball.mat',...
           'feAdspm12meg14_0431_140218_TaskBlock2_raw_mc_oddball.mat',...
           'feAdspm12meg14_0431_140218_TaskBlock1_raw_mc_oddball.mat',...
           'feAdspm12meg14_0430_140218_TaskBlock2_raw_mc_oddball.mat',...
           'feAdspm12meg14_0430_140218_TaskBlock1_raw_mc_oddball.mat',...
           'feAdspm12meg14_0155_140404_Oddball2_raw_mc_oddball.mat',...
           'feAdspm12meg14_0155_140404_Oddball1_raw_mc_oddball.mat',...
           'feAdspm12meg13_0545_131217_Oddball2_raw_mc_oddball.mat',...
           'feAdspm12meg13_0545_131217_Oddball1_raw_mc_oddball.mat',...
           'feAdspm12meg13_0544_131217_Oddball2_raw_mc_oddball.mat',...
           'feAdspm12meg13_0544_131217_Oddball1_raw_mc_oddball.mat',...
           'feAdspm12meg13_0540_131216_Oddball2_raw_mc_oddball.mat',...
           'feAdspm12meg13_0540_131216_Oddball1_raw_mc_oddball.mat',...
           'feAdspm12meg13_0539_131216_Oddball2_raw_mc_oddball.mat',...
           'feAdspm12meg13_0539_131216_Oddball1_raw_mc_oddball.mat',...
           'feAdspm12meg13_0502_131121_Oddball3_raw_mc_oddball.mat',...
           'feAdspm12meg13_0502_131121_Oddball2_raw_mc_oddball.mat',...
           'feAdspm12meg13_0502_131121_Oddball1_raw_mc_oddball.mat',...
           'feAdspm12meg13_0495_131114_Oddball2_raw_mc_oddball.mat',...
           'feAdspm12meg13_0495_131114_Oddball1_raw_mc_oddball.mat',...
           'feAdspm12meg13_0494_131114_Oddball2_raw_mc_oddball.mat',...
           'feAdspm12meg13_0494_131114_Oddball1_raw_mc_oddball.mat',...
           'feAdspm12meg13_0488_131111_Oddball2_raw_mc_oddball.mat',...
           'feAdspm12meg13_0488_131111_Oddball1_raw_mc_oddball.mat',...
           'feAdspm12meg13_0442_131010_TaskBlock2_raw_mc_oddball.mat',...
           'feAdspm12meg13_0442_131010_TaskBlock1_raw_mc_oddball.mat',...
           'feAdspm12meg13_0441_131010_TaskBlock3_raw_mc_oddball.mat',...
           'feAdspm12meg13_0441_131010_TaskBlock2_raw_mc_oddball.mat',...
           'feAdspm12meg13_0441_131010_TaskBlock1_raw_mc_oddball.mat'};

%% Average

for i=1:length(filenames)
file=fullfile(base,filenames{i})

clear matlabbatch

matlabbatch{1}.spm.meeg.averaging.average.D ={file};
matlabbatch{1}.spm.meeg.averaging.average.userobust.standard = false;
matlabbatch{1}.spm.meeg.averaging.average.plv = false;
matlabbatch{1}.spm.meeg.averaging.average.prefix = 'm';
spm_jobman('run', matlabbatch);
end;

